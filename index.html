<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Mini Jump Multiplayer</title>
  <style>
    body {
      margin: 0; display: flex; justify-content: center; align-items: center;
      height: 100vh; background: linear-gradient(to top, #87cefa, #e0f7fa);
      font-family: sans-serif;
    }
    #menu, #game, #overlay, #final {
      display: none; flex-direction: column; align-items: center; justify-content: center;
    }
    #menu { display: flex; }
    h1 {
      font-size: 34px; color: #222; margin-bottom: 8px;
    }
    h2 { margin: 0 0 15px; font-weight: normal; color: #444; }
    #game {
      position: relative; width: 700px; height: 300px;
      background: #cce5ff; border: 3px solid #333; overflow: hidden;
    }
    #ground {
      position: absolute; bottom: 0; width: 100%; height: 60px;
      background: #4caf50;
    }
    #player {
      position: absolute; bottom: 60px; left: 50px;
      width: 35px; height: 35px; background: dodgerblue;
      border-radius: 6px; box-shadow: 0 3px 5px rgba(0,0,0,0.3);
    }
    .shadow {
      position: absolute; bottom: 55px; left: 50px;
      width: 35px; height: 5px; border-radius: 50%;
      background: rgba(0,0,0,0.3);
    }
    .obstacle {
      position: absolute; bottom: 60px;
      width: 25px; height: 45px; background: tomato;
      border-radius: 4px;
    }
    .cloud {
      position: absolute; top: 30px; width: 60px; height: 30px;
      background: white; border-radius: 50%;
      box-shadow: 20px 10px 0 white, 40px 0 0 white;
      opacity: 0.8;
    }
    #scoreboard {
      position: absolute; top: 5px; left: 5px;
      font-size: 14px; font-weight: bold; color: #222;
    }
    #overlay, #final {
      position: absolute; inset: 0; background: rgba(0,0,0,0.6);
      display: none; flex-direction: column; align-items: center; justify-content: center;
      color: white; font-size: 22px;
    }
    button {
      margin-top: 10px; padding: 6px 12px; font-size: 16px;
      border: none; border-radius: 6px; cursor: pointer;
    }
    input {
      padding: 6px; margin: 5px; border: 1px solid #aaa; border-radius: 6px;
    }
    .score-pop {
      position: absolute; color: gold; font-weight: bold;
      animation: pop 0.7s ease-out forwards;
    }
    @keyframes pop {
      0% { opacity: 1; transform: translateY(0); }
      100% { opacity: 0; transform: translateY(-25px); }
    }
  </style>
</head>
<body>
  <!-- Menu Registrasi -->
  <div id="menu">
    <h1>üéÆ Mini Jump Game</h1>
    <h2>Daftar Pemain</h2>
    <div id="inputs"></div>
    <button id="addPlayer">+ Tambah Pemain</button>
    <button id="startGame">Mulai Game</button>
  </div>

  <!-- Game -->
  <div id="game">
    <div class="cloud" style="left:150px"></div>
    <div class="cloud" style="left:400px; top:60px"></div>
    <div id="player"></div>
    <div class="shadow"></div>
    <div id="ground"></div>
    <div id="scoreboard">
      Giliran: <span id="turnName"></span> |
      Skor: <span id="currentScore">0</span>
    </div>
    <div id="overlay">
      <div id="gameover-text">üí• Game Over!</div>
      <button id="next">Giliran Berikutnya</button>
    </div>
    <div id="final">
      <div id="winner"></div>
      <button onclick="location.reload()">Main Lagi</button>
    </div>
  </div>

  <script>
    const menu = document.getElementById("menu");
    const inputsDiv = document.getElementById("inputs");
    const addPlayerBtn = document.getElementById("addPlayer");
    const startBtn = document.getElementById("startGame");
    const game = document.getElementById("game");
    const player = document.getElementById("player");
    const shadow = document.querySelector(".shadow");
    const turnNameEl = document.getElementById("turnName");
    const currentScoreEl = document.getElementById("currentScore");
    const overlay = document.getElementById("overlay");
    const nextBtn = document.getElementById("next");
    const final = document.getElementById("final");
    const winnerEl = document.getElementById("winner");

    let players = [], scores = [], currentPlayer = 0;
    let jump = false, y = 0, score = 0;
    let obstacles = [], speed = 5, alive = true;

    // Tambah input pemain
    addPlayerBtn.onclick = () => {
      const inp = document.createElement("input");
      inp.placeholder = "Nama pemain";
      inputsDiv.appendChild(inp);
    };
    addPlayerBtn.click(); addPlayerBtn.click(); // default 2

    startBtn.onclick = () => {
      const inputs = inputsDiv.querySelectorAll("input");
      players = [];
      inputs.forEach(inp => { if (inp.value.trim() !== "") players.push(inp.value.trim()); });
      if (players.length < 2) return alert("Minimal 2 pemain!");
      scores = new Array(players.length).fill(0);
      menu.style.display = "none"; game.style.display = "flex";
      startTurn();
    };

    document.addEventListener("keydown", e => {
      if (e.code === "Space" && alive) jump = true;
    });

    nextBtn.onclick = () => {
      scores[currentPlayer] = score;
      currentPlayer++;
      if (currentPlayer < players.length) startTurn();
      else showFinal();
    };

    function startTurn() {
      resetGame();
      turnNameEl.textContent = players[currentPlayer];
      player.style.background = ["dodgerblue","seagreen","purple","orange"][currentPlayer % 4];
    }

    function resetGame() {
      obstacles.forEach(o => o.remove()); obstacles = [];
      score = 0; y = 0; player.style.bottom = "60px";
      speed = 5; alive = true; overlay.style.display = "none";
      requestAnimationFrame(gameLoop);
    }

    function gameLoop() {
      if (!alive) { overlay.style.display = "flex"; return; }

      if (jump) { y += 6; if (y >= 120) jump = false; }
      else if (y > 0) y -= 6;
      player.style.bottom = (60 + y) + "px";
      shadow.style.width = 35 - y*0.1 + "px";

      if (Math.random() < 0.02) {
        const obs = document.createElement("div");
        obs.className = "obstacle";
        obs.style.left = "700px";
        game.appendChild(obs); obstacles.push(obs);
      }

      obstacles.forEach((obs, i) => {
        let x = parseInt(obs.style.left);
        obs.style.left = (x - speed) + "px";
        if (x < 80 && x > 50 && y < 40) alive = false;
        if (x < -30) {
          obs.remove(); obstacles.splice(i, 1);
          score++; currentScoreEl.textContent = score;
          showScorePop();
        }
      });

      requestAnimationFrame(gameLoop);
    }

    function showScorePop() {
      const pop = document.createElement("div");
      pop.className = "score-pop";
      pop.style.left = "90px"; pop.style.bottom = (80 + y) + "px";
      pop.textContent = "+1";
      game.appendChild(pop);
      setTimeout(()=>pop.remove(),700);
    }

    function showFinal() {
      let maxScore = Math.max(...scores);
      let winners = players.filter((p,i)=>scores[i]===maxScore);
      winnerEl.textContent = `üèÜ Pemenang: ${winners.join(", ")} (Skor ${maxScore})`;
      overlay.style.display = "none"; final.style.display = "flex";
    }
  </script>
</body>
</html>
